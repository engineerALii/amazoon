<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Amazon Supplements</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Cinzel+Decorative:wght@700;900&family=Russo+One&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* =========================================
           1. Modern Design System
           ========================================= */
        :root {
            --font-main: 'Cairo', sans-serif;
            --font-logo: 'Cinzel Decorative', cursive; /* Fancy Font for Logo */
            --font-english: 'Russo One', sans-serif; /* Bold Font for English Text */
            
            /* Premium Light Theme */
            --bg-body: #f8f9fa; /* Lighter, cleaner background */
            --bg-card: #ffffff;
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --primary-color: #0984e3;
            --primary-gradient: linear-gradient(135deg, #0984e3 0%, #00cec9 100%);
            --accent-color: #d63031;
            --accent-gradient: linear-gradient(135deg, #d63031 0%, #e17055 100%);
            --border-color: #dfe6e9;
            --glass-bg: rgba(255, 255, 255, 0.98);
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.05);
            --shadow-md: 0 10px 15px rgba(0,0,0,0.08);
            --shadow-lg: 0 20px 25px rgba(0,0,0,0.1);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --transition: cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
        }

        /* Themes */
        [data-theme="dark"] {
            --bg-body: #121212; --bg-card: #1e1e1e; --text-primary: #dfe6e9; --text-secondary: #b2bec3;
            --primary-color: #3742fa; --primary-gradient: linear-gradient(135deg, #3742fa 0%, #0984e3 100%);
            --border-color: #2d3436; --glass-bg: rgba(30, 30, 30, 0.98);
        }
        [data-theme="sport-red"] {
            --bg-body: #2d1313; --bg-card: #3d1a1a; --text-primary: #fff; --text-secondary: #e2e2e2;
            --primary-color: #ff4757; --primary-gradient: linear-gradient(135deg, #ff4757 0%, #ff6b81 100%);
            --border-color: #592525; --glass-bg: rgba(61, 26, 26, 0.95);
        }
        [data-theme="sport-green"] {
            --bg-body: #0d2112; --bg-card: #15331c; --text-primary: #fff; --text-secondary: #e2e2e2;
            --primary-color: #2ecc71; --primary-gradient: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            --border-color: #1e4d2b; --glass-bg: rgba(21, 51, 28, 0.95);
        }
        [data-theme="royal-gold"] {
            --bg-body: #1c1c1c; --bg-card: #2a2a2a; --text-primary: #ffd700; --text-secondary: #d4af37;
            --primary-color: #ffd700; --primary-gradient: linear-gradient(135deg, #ffd700 0%, #fdb931 100%);
            --accent-color: #fff; --border-color: #444; --glass-bg: rgba(28, 28, 28, 0.95);
        }
        [data-theme="midnight-purple"] {
            --bg-body: #1a0b2e; --bg-card: #2d1b4e; --text-primary: #e0d4fc; --text-secondary: #b39ddb;
            --primary-color: #7b1fa2; --primary-gradient: linear-gradient(135deg, #7b1fa2 0%, #9c27b0 100%);
            --accent-color: #00e5ff; --border-color: #4a148c; --glass-bg: rgba(26, 11, 46, 0.95);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            overflow-x: hidden;
            width: 100%;
            position: relative;
            touch-action: pan-y;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-body);
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
            line-height: 1.6;
            font-weight: 700; /* BOLD globally */
            text-transform: uppercase; /* Uppercase globally (affects English primarily) */
        }

        /* Specific override for Arabic flow text to avoid awkward spacing if needed */
        p, span, div, h1, h2, h3, h4, h5, h6 {
            letter-spacing: 0.5px;
        }

        a { text-decoration: none; color: inherit; transition: var(--transition); }
        ul { list-style: none; }
        img { max-width: 100%; display: block; }
        button { font-family: var(--font-main); cursor: pointer; border: none; outline: none; transition: var(--transition); font-weight: 900; text-transform: uppercase; }

        /* =========================================
           2. Header & Logo
           ========================================= */
        header {
            background-color: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* FANCY LOGO STYLE */
        .logo {
            font-family: var(--font-logo);
            font-size: 32px;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .logo::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent-gradient);
            border-radius: 50%;
        }

        .nav-links {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .nav-links a {
            font-weight: 800;
            font-size: 16px;
            color: var(--text-secondary);
            position: relative;
            font-family: var(--font-main);
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary-color);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -6px;
            right: 0;
            width: 0;
            height: 4px;
            background: var(--primary-gradient);
            border-radius: 4px;
            transition: var(--transition);
        }

        .nav-links a:hover::after, .nav-links a.active::after { width: 100%; }

        .nav-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-btn {
            background: var(--bg-body);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-color);
        }

        .icon-btn:hover {
            transform: translateY(-2px);
            color: #fff;
            background: var(--primary-gradient);
            border-color: transparent;
            box-shadow: var(--shadow-md);
        }

        /* Hidden by default, shown only to admin */
        #themeSwitcherBtn {
            display: none; 
        }

        .cart-wrapper { position: relative; }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-gradient);
            color: white;
            font-size: 11px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            border: 2px solid var(--bg-card);
        }

        /* =========================================
           3. Hero & Cards
           ========================================= */
        .hero {
            position: relative;
            padding: 80px 0;
            overflow: hidden;
            background-color: var(--bg-body);
            background-image: radial-gradient(var(--border-color) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .hero-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
            gap: 40px;
        }

        .hero-content { z-index: 2; }

        .hero-badge {
            display: inline-block;
            background: rgba(9, 132, 227, 0.1);
            color: var(--primary-color);
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 800;
            font-size: 14px;
            margin-bottom: 20px;
            border: 2px solid rgba(9, 132, 227, 0.2);
        }

        .hero h1 {
            font-size: 3.5rem;
            line-height: 1.15;
            margin-bottom: 25px;
            font-weight: 900;
            text-transform: uppercase;
        }
        
        .hero h1 span {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
            max-width: 500px;
            font-weight: 600;
        }

        .hero-btns {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 30px;
            border-radius: 50px;
            font-weight: 900;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: #fff;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary:hover {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 3px solid var(--border-color);
        }
        
        .btn-outline:hover {
            border-color: var(--text-primary);
            background: var(--text-primary);
            color: var(--bg-card);
        }

        .hero-image {
            position: relative;
            z-index: 1;
            animation: float 6s ease-in-out infinite;
        }

        .hero-image img {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            filter: drop-shadow(0 30px 60px rgba(0,0,0,0.2));
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        .section-header { text-align: center; margin: 80px 0 50px; }
        .section-title { font-size: 2.8rem; font-weight: 900; margin-bottom: 10px; text-transform: uppercase; }
        .section-subtitle { color: var(--text-secondary); font-size: 1.2rem; font-weight: 600; }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            padding-bottom: 60px;
        }

        .product-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            transition: var(--transition);
            position: relative;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .card-img-box {
            height: 280px;
            width: 100%;
            padding: 0; /* REMOVED PADDING */
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent; /* REMOVED WHITE BG */
            border-bottom: 1px solid var(--border-color);
        }

        .card-img-box img {
            max-height: 100%;
            max-width: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .product-card:hover .card-img-box img { transform: scale(1.1); }

        .card-tag {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--accent-gradient);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 900;
            z-index: 10;
            box-shadow: 0 4px 10px rgba(255, 63, 52, 0.3);
            text-transform: uppercase;
        }
        
        .card-content {
            padding: 25px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .card-title {
            font-size: 20px;
            font-weight: 800; /* Extra Bold */
            margin-bottom: 10px;
            line-height: 1.4;
            color: var(--text-primary);
            font-family: var(--font-english); /* English Font */
        }

        .card-brand-name {
            font-size: 13px;
            text-transform: uppercase;
            color: var(--text-secondary);
            font-weight: 800;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .card-price-row {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .price {
            font-size: 24px;
            font-weight: 900;
            color: var(--text-primary);
        }
        
        .add-cart-btn {
            background: var(--text-primary);
            color: var(--bg-card);
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 18px;
        }
        
        .add-cart-btn:hover {
            background: var(--primary-color);
            color: #fff;
            transform: rotate(90deg);
        }

        /* Categories Page Grid */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding-bottom: 60px;
        }

        .category-card {
            height: 350px;
            border-radius: var(--radius-lg);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            background: var(--bg-card);
        }

        .category-card:hover { transform: translateY(-10px); box-shadow: var(--shadow-lg); }

        .category-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.8s ease;
        }

        .category-card:hover img { transform: scale(1.15); }

        .category-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.2) 60%, transparent 100%);
            display: flex;
            align-items: flex-end;
            padding: 30px;
            z-index: 2;
        }

        .category-info h3 {
            color: #fff;
            font-size: 36px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
            font-family: var(--font-english);
        }

        .category-info p {
            color: rgba(255,255,255,0.9);
            font-size: 16px;
            font-weight: 700;
        }

        /* Footer */
        .site-footer {
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            padding: 60px 0 20px;
            margin-top: 50px;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-col h4 {
            font-size: 20px;
            font-weight: 900;
            margin-bottom: 20px;
            color: var(--primary-color);
            text-transform: uppercase;
        }

        .footer-col p, .footer-col a {
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
            font-size: 15px;
        }

        .footer-col a:hover { color: var(--primary-color); }

        .footer-contact i {
            margin-left: 10px;
            color: var(--accent-color);
            width: 20px;
            text-align: center;
        }

        .copy-right {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
        }

        /* Other Components */
        .slider-wrapper { background: var(--bg-card); padding: 50px 0; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); }
        .slider-track-container { overflow: hidden; padding: 20px 0; position: relative; }
        .slider-track { display: flex; gap: 25px; width: max-content; animation: scroll 30s linear infinite; }
        .slider-track:hover { animation-play-state: paused; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(1000px); } }

        .brands-section { padding: 60px 0; background: var(--bg-body); }
        .brands-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
            justify-content: center;
        }
        .brand-card { 
            background: #fff; 
            border: 1px solid var(--border-color); 
            border-radius: var(--radius-md); 
            padding: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            transition: var(--transition); 
            height: 120px; 
            box-shadow: var(--shadow-sm); 
        }
        .brand-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); border-color: var(--primary-color); }
        
        .brand-card img { 
            width: auto; 
            height: auto; 
            max-width: 100%; 
            max-height: 100%; 
            object-fit: contain; 
            transition: var(--transition); 
            filter: grayscale(100%); 
            opacity: 0.8;
        }
        .brand-card:hover img {
            filter: grayscale(0%);
            opacity: 1;
            transform: scale(1.05);
        }

        /* Admin Brands & Categories List Styles */
        .admin-brands-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            overflow-y: auto; 
            max-height: 55vh; 
            padding-right: 5px;
            flex-grow: 1; 
        }
        
        .admin-brands-list::-webkit-scrollbar { width: 6px; }
        .admin-brands-list::-webkit-scrollbar-track { background: transparent; }
        .admin-brands-list::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 10px; }
        .admin-brands-list::-webkit-scrollbar-thumb:hover { background-color: var(--text-secondary); }

        .admin-brand-item { display: flex; align-items: center; justify-content: space-between; background: var(--bg-body); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); flex-shrink: 0; }
        .admin-brand-info { display: flex; align-items: center; gap: 15px; }
        .admin-brand-img { width: 60px; height: 40px; object-fit: contain; background: #fff; border-radius: 4px; padding: 5px; }

        .filters-container { background: var(--bg-card); padding: 15px; border-radius: var(--radius-md); box-shadow: var(--shadow-sm); display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; align-items: center; margin-bottom: 40px; border: 1px solid var(--border-color); }
        .search-input { flex: 1; min-width: 250px; padding: 12px 20px; border-radius: 50px; border: 2px solid var(--border-color); background: var(--bg-body); color: var(--text-primary); font-family: var(--font-main); outline: none; transition: var(--transition); font-weight: 700; }
        .search-input:focus { border-color: var(--primary-color); }

        .cat-pills { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .cat-pill { padding: 10px 25px; border-radius: 50px; background: var(--bg-body); color: var(--text-secondary); font-weight: 800; font-size: 14px; white-space: nowrap; border: 2px solid transparent; text-transform: uppercase; }
        .cat-pill:hover { background: #e9ecef; }
        .cat-pill.active { background: var(--primary-gradient); color: #fff; box-shadow: 0 4px 12px rgba(0, 86, 179, 0.2); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        
        /* Updated Modal Box with Scrolling enabled if needed */
        .modal-box { 
            background: var(--bg-card); 
            width: 1000px; 
            max-width: 100%; 
            border-radius: var(--radius-lg); 
            overflow: hidden; 
            display: flex; 
            box-shadow: var(--shadow-lg); 
            position: relative; 
            max-height: 90vh; 
            animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            flex-direction: column; 
        }
        
        /* Specific scroll for modals with forms */
        .modal-box.scrollable {
            overflow-y: auto;
        }

        @media(min-width: 768px) { .modal-box:not(.scrollable) { flex-direction: row; } .modal-left { flex: 1.2; height: auto; } .modal-right { flex: 1; overflow-y: auto; } }
        @keyframes modalPop { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-left { background: #fff; padding: 40px; display: flex; align-items: center; justify-content: center; height: 300px; }
        .modal-right { padding: 40px; display: flex; flex-direction: column; overflow-y: auto; }
        .modal-close { position: absolute; top: 20px; left: 20px; background: var(--bg-body); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; box-shadow: var(--shadow-sm); font-size: 20px; font-weight: bold; }

        .hamburger { display: none; font-size: 24px; color: var(--text-primary); background: none; }
        @media (max-width: 900px) {
            .hero-container { grid-template-columns: 1fr; text-align: center; }
            .hero-image { order: -1; margin-bottom: 30px; }
            .hero-btns { justify-content: center; }
            .hero h1 { font-size: 2.5rem; }
            .modal-box { flex-direction: column; overflow-y: auto; }
            .modal-left { padding: 20px; height: 250px; }
        }
        @media (max-width: 768px) {
            .nav-links { display: none; position: fixed; top: 70px; left: 0; right: 0; background: var(--bg-card); flex-direction: column; padding: 30px; border-bottom: 1px solid var(--border-color); box-shadow: var(--shadow-lg); }
            .nav-links.active { display: flex; }
            .hamburger { display: block; }
            .products-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .card-img-box { height: 160px; padding: 0; }
            .card-content { padding: 15px; }
            .card-title { font-size: 14px; }
            .price { font-size: 16px; }
            .add-cart-btn { width: 32px; height: 32px; font-size: 14px; }
        }
        @media (max-width: 480px) {
            .products-grid { grid-template-columns: 1fr; }
            .card-img-box { height: 220px; }
            .hero h1 { font-size: 2rem; }
            .container { padding: 0 15px; }
        }

        /* Improved Textarea Style */
        textarea.search-input {
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
            font-family: var(--font-main);
        }

        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(50px); background: rgba(30, 39, 46, 0.95); color: #fff; padding: 12px 30px; border-radius: 50px; font-weight: 800; box-shadow: var(--shadow-lg); opacity: 0; transition: var(--transition); z-index: 5000; backdrop-filter: blur(5px); white-space: nowrap; text-transform: uppercase; }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <header>
        <div class="container nav-wrapper">
            <button class="hamburger" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
            
            <!-- Fancy Styled Logo -->
            <div class="logo">AMAZON</div>
            
            <nav class="nav-links" id="navLinks">
                <a href="#" onclick="navigate('home', event)" class="active">الرئيسية</a>
                <a href="#" onclick="navigate('products', event)">المنتجات</a>
                <a href="#" onclick="navigate('categories', event)">الأقسام</a>
            </nav>

            <div class="nav-icons">
                <!-- Theme Button (Hidden by default, shown via JS for Admin) -->
                <button class="icon-btn" id="themeSwitcherBtn" onclick="openThemeModal()" title="تغيير المظهر">
                    <i class="fas fa-palette"></i>
                </button>

                <div class="cart-wrapper" onclick="openCheckout()">
                    <button class="icon-btn"><i class="fas fa-shopping-bag"></i></button>
                    <span class="cart-count" id="cartCount">0</span>
                </div>
                <button class="icon-btn" onclick="openAdminCheck()"><i class="fas fa-user"></i></button>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- HOME PAGE -->
        <div id="home-page" class="page-section">
            <section class="hero">
                <div class="hero-container">
                    <div class="hero-content">
                        <span class="hero-badge" id="heroBadge"><i class="fas fa-fire"></i> الخيار الأول للرياضيين</span>
                        <h1 id="heroTitle">أداء أقوى.<br><span>نتائج أسرع.</span></h1>
                        <p id="heroDesc">احصل على أفضل المكملات الغذائية العالمية بأسعار تنافسية. بروتينات، كرياتين، وفيتامينات أصلية 100%.</p>
                        <div class="hero-btns">
                            <a href="#" onclick="navigate('products', null)" class="btn btn-primary">تسوق الآن <i class="fas fa-arrow-left"></i></a>
                            <a href="#" class="btn btn-outline">عرض العروض</a>
                        </div>
                    </div>
                    <div class="hero-image">
                        <img id="heroImgDisplay" src="https://gymers.weebly.com/uploads/5/3/0/4/53045443/3113257_orig.png" alt="Supplement Jar">
                    </div>
                </div>
            </section>
            
            <!-- Brands Section -->
            <section class="brands-section">
                <div class="section-header">
                    <h2 class="section-title">تسوق حسب العلامة التجارية</h2>
                    <p class="section-subtitle">أشهر الماركات العالمية في مكان واحد</p>
                </div>
                <div class="brands-grid" id="brandsGrid">
                    <!-- Brands will be filled by JS -->
                </div>
            </section>

            <div class="section-header">
                <h2 class="section-title">الأكثر مبيعاً</h2>
                <p class="section-subtitle">منتجات يثق بها المحترفون</p>
            </div>
            
            <div class="slider-wrapper">
                <div class="slider-track-container" id="sliderContainer">
                    <div class="slider-track" id="sliderTrack"></div>
                </div>
            </div>
        </div>

        <!-- CATEGORIES PAGE -->
        <div id="categories-page" class="page-section hidden">
            <div class="section-header">
                <h2 class="section-title">تصفح الأقسام</h2>
                <p class="section-subtitle">كل ما تحتاجه للوصول لهدفك</p>
            </div>
            <div class="categories-grid" id="categoriesGrid">
                <!-- Filled via JS -->
            </div>
        </div>

        <!-- PRODUCTS PAGE -->
        <div id="products-page" class="page-section hidden">
            <div class="section-header">
                <h2 class="section-title">جميع المنتجات</h2>
            </div>
            
            <div class="filters-container">
                <div style="flex: 1; min-width: 250px;">
                    <input type="text" id="searchInput" class="search-input" style="min-height:auto;" placeholder="ابحث عن منتج..." onkeyup="filterProducts()">
                </div>
                <div class="cat-pills" id="categoryFilters">
                    <button class="cat-pill active" data-cat="all" onclick="filterCategory('all', event)">الكل</button>
                    <!-- Filled by JS based on categories -->
                </div>
            </div>
            
            <div id="activeBrandFilter" style="display:none; margin-bottom: 20px; align-items: center; gap: 10px; background: var(--bg-card); padding: 10px 20px; border-radius: 50px; border: 1px solid var(--primary-color); color: var(--primary-color); width: fit-content; font-weight: bold;">
                <span id="activeBrandName">اسم البراند</span>
                <i class="fas fa-times" style="cursor: pointer;" onclick="clearBrandFilter()"></i>
            </div>

            <div class="products-grid" id="all-products"></div>
        </div>

        <!-- ADMIN PAGE -->
        <div id="admin-page" class="page-section hidden">
            <div class="section-header">
                <h2 class="section-title">لوحة التحكم</h2>
            </div>
            
            <div class="filters-container">
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                    <button class="btn btn-primary" onclick="showAddProductModal()">إضافة منتج</button>
                    <button class="btn btn-outline" onclick="showBrandsModal()">إدارة البراندات <i class="fas fa-tags"></i></button>
                    <button class="btn btn-outline" onclick="showCategoriesModal()">إدارة الأقسام <i class="fas fa-layer-group"></i></button>
                    <button class="btn btn-outline" onclick="showSiteSettingsModal()">إعدادات الموقع <i class="fas fa-cog"></i></button>
                    <button class="btn btn-outline" style="border-color:#ff4757; color:#ff4757;" onclick="logoutAdmin()">خروج</button>
                </div>
            </div>

            <div class="products-grid" id="admin-grid"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>AMAZON SUPPS</h4>
                    <p>المصدر الأول للمكملات الغذائية الأصلية. نوفر لك أفضل العلامات التجارية العالمية لضمان تحقيق أهدافك الرياضية.</p>
                </div>
                <div class="footer-col footer-contact">
                    <h4>تواصل معنا</h4>
                    <p><i class="fas fa-map-marker-alt"></i> بغداد، شارع المتنبي، مجمع الرياضة</p>
                    <p><i class="fas fa-phone"></i> +964 770 123 4567</p>
                    <p><i class="fas fa-envelope"></i> support@amazonsupps.com</p>
                </div>
                <div class="footer-col">
                    <h4>روابط سريعة</h4>
                    <a href="#" onclick="navigate('home', null)">الرئيسية</a>
                    <a href="#" onclick="navigate('products', null)">المنتجات</a>
                    <a href="#" onclick="navigate('categories', null)">الأقسام</a>
                </div>
            </div>
            <div class="copy-right">
                &copy; 2024 Amazon Supplements. All Rights Reserved.
            </div>
        </div>
    </footer>

    <!-- Product Modal -->
    <div id="productModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-close" onclick="closeModal('productModal')"><i class="fas fa-times"></i></div>
            <div class="modal-left">
                <img id="modal-img" src="" alt="" style="max-height: 100%; max-width: 100%; object-fit: contain;">
            </div>
            <div class="modal-right">
                <span id="modal-cat" style="color:var(--primary-color); font-weight:800; font-size:14px; font-family:var(--font-english);">CATEGORY</span>
                <span id="modal-brand" style="color:var(--text-secondary); font-weight:800; font-size:14px; display:block; margin-top:5px; font-family:var(--font-english);">BRAND</span>
                <h2 id="modal-title" style="font-size:2.5rem; margin: 10px 0; font-family:var(--font-english);">Product Name</h2>
                <div style="color:#f1c40f; margin-bottom: 20px;">
                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                </div>
                <h3 id="modal-price" style="font-size:3rem; font-weight:900; color:var(--text-primary); margin-bottom:20px;">$55.00</h3>
                <p id="modal-desc" style="color:var(--text-secondary); line-height:1.7; margin-bottom:30px; font-size:1.1rem; font-weight:600;"></p>
                <button class="btn btn-primary" style="width:100%; justify-content:center; padding: 18px;" onclick="addToCartFromModal()">
                    إضافة إلى السلة <i class="fas fa-shopping-bag"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Theme Selection Modal (Expanded) -->
    <div id="themeModal" class="modal-overlay">
         <div class="modal-box" style="width: 500px; flex-direction: column; padding: 40px; text-align:center;">
            <div class="modal-close" onclick="closeModal('themeModal')"><i class="fas fa-times"></i></div>
            <h2 style="margin-bottom: 30px;">اختر مظهر الموقع</h2>
            <div class="products-grid" style="grid-template-columns: 1fr 1fr; gap: 20px; padding: 0; box-shadow:none;">
                <button class="cat-pill" style="background:#f0f2f5; color:#1e272e; width:100%; justify-content:center; padding:15px; border-radius:12px;" onclick="setTheme('light')">Light <i class="fas fa-sun"></i></button>
                <button class="cat-pill" style="background:#181818; color:#fff; width:100%; justify-content:center; padding:15px; border-radius:12px;" onclick="setTheme('dark')">Dark <i class="fas fa-moon"></i></button>
                <button class="cat-pill" style="background:#ff4757; color:#fff; width:100%; justify-content:center; padding:15px; border-radius:12px;" onclick="setTheme('sport-red')">Sport Red <i class="fas fa-fire"></i></button>
                <button class="cat-pill" style="background:#2ecc71; color:#fff; width:100%; justify-content:center; padding:15px; border-radius:12px;" onclick="setTheme('sport-green')">Sport Green <i class="fas fa-leaf"></i></button>
                <button class="cat-pill" style="background:#ffd700; color:#1c1c1c; width:100%; justify-content:center; padding:15px; border-radius:12px;" onclick="setTheme('royal-gold')">Royal Gold <i class="fas fa-crown"></i></button>
                <button class="cat-pill" style="background:#7b1fa2; color:#fff; width:100%; justify-content:center; padding:15px; border-radius:12px;" onclick="setTheme('midnight-purple')">Midnight Purple <i class="fas fa-bolt"></i></button>
            </div>
         </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="modal-overlay">
        <div class="modal-box" style="width: 500px; flex-direction: column; padding: 40px;">
            <div class="modal-close" onclick="closeModal('checkoutModal')"><i class="fas fa-times"></i></div>
            <h2 style="margin-bottom: 20px; text-align: center;">إتمام الطلب</h2>
            <form onsubmit="handleCheckout(event)" style="display:flex; flex-direction:column; gap:15px;">
                <input type="text" id="custName" class="search-input" placeholder="الاسم الكامل" style="min-height:auto;" required>
                <input type="tel" id="custPhone" class="search-input" placeholder="رقم الهاتف" style="min-height:auto;" required>
                <select id="custGov" class="search-input" style="min-height:auto;" required>
                    <option value="" disabled selected>اختر المحافظة</option>
                    <option value="Cairo">بغداد</option>
                    <option value="Giza">البصرة</option>
                    <option value="Alex">أربيل</option>
                    <option value="Other">محافظة أخرى</option>
                </select>
                <textarea id="custAddress" class="search-input" rows="3" placeholder="العنوان بالتحديد (المنطقة، الشارع، علامة مميزة)" required></textarea>
                
                <div style="background: var(--bg-body); padding: 15px; border-radius: 8px; margin-top: 10px;">
                    <div style="display:flex; justify-content:space-between; font-weight:bold;">
                        <span>إجمالي السلة:</span>
                        <span id="checkoutTotal" style="color:var(--primary-color);">$0.00</span>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="justify-content: center;">تأكيد الطلب</button>
            </form>
        </div>
    </div>

    <!-- Login Overlay -->
    <div id="loginOverlay" class="modal-overlay" style="z-index: 3000;">
        <div class="modal-box" style="width: 400px; flex-direction: column; padding: 40px; text-align: center;">
            <h2 style="margin-bottom: 20px;">تسجيل الدخول</h2>
            <input type="password" id="adminPass" class="search-input" style="min-height:auto;" placeholder="كلمة المرور" style="margin-bottom: 20px; width: 100%;">
            <button class="btn btn-primary" style="width: 100%; justify-content: center;" onclick="checkLogin()">دخول</button>
            <button style="margin-top: 15px; background: none; color: var(--text-secondary);" onclick="closeLogin()">إلغاء</button>
        </div>
    </div>

    <!-- Edit Product Modal (Fix: Scrollable) -->
    <div id="editModal" class="modal-overlay">
        <div class="modal-box scrollable" style="width: 500px; padding: 40px;">
            <div class="modal-close" onclick="closeModal('editModal')"><i class="fas fa-times"></i></div>
            <h2 style="margin-bottom: 20px;">إدارة المنتج</h2>
            <form onsubmit="handleProductSubmit(event)" style="display:flex; flex-direction:column; gap:15px;">
                <input type="hidden" id="editId">
                <input type="text" id="editName" class="search-input" style="min-height:auto;" placeholder="اسم المنتج (English Name)" required>
                <input type="number" id="editPrice" class="search-input" style="min-height:auto;" placeholder="السعر" required>
                <select id="editCat" class="search-input" style="min-height:auto;">
                    <!-- Filled by JS -->
                </select>
                <input type="text" id="editBrand" class="search-input" style="min-height:auto;" placeholder="اسم البراند">
                
                <div style="border: 1px dashed var(--border-color); padding: 10px; border-radius: 8px;">
                    <label style="display:block; margin-bottom:5px; font-size:14px; font-weight:bold;">صورة المنتج</label>
                    <input type="text" id="editImg" class="search-input" style="min-height:auto;" placeholder="رابط الصورة (URL)" style="margin-bottom: 10px;">
                    <input type="file" id="editImgFile" accept="image/*" class="search-input" style="min-height:auto; padding-top: 8px;">
                </div>

                <!-- Styled Description (No Translate Button) -->
                <div>
                    <label style="display:block; margin-bottom:5px; font-size:14px; font-weight:bold;">الوصف</label>
                    <textarea id="editDesc" class="search-input" rows="5" placeholder="وصف المنتج..." style="width:100%;"></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="justify-content: center;">حفظ</button>
            </form>
        </div>
    </div>

    <!-- Site Settings Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-box" style="width: 500px; flex-direction: column; padding: 40px;">
            <div class="modal-close" onclick="closeModal('settingsModal')"><i class="fas fa-times"></i></div>
            <h2 style="margin-bottom: 20px;">إعدادات الموقع</h2>
            <form onsubmit="handleSettingsSubmit(event)" style="display:flex; flex-direction:column; gap:15px;">
                <label style="font-weight:bold;">العنوان الرئيسي</label>
                <input type="text" id="setHeroTitle" class="search-input" style="min-height:auto;" required>
                
                <label style="font-weight:bold;">الوصف الرئيسي</label>
                <textarea id="setHeroDesc" class="search-input" rows="3" required></textarea>
                
                <label style="font-weight:bold;">صورة الهيرو</label>
                <div style="border: 1px dashed var(--border-color); padding: 10px; border-radius: 8px;">
                    <input type="text" id="setHeroImg" class="search-input" style="min-height:auto;" placeholder="رابط الصورة (URL)" style="margin-bottom: 10px;">
                    <input type="file" id="setHeroImgFile" accept="image/*" class="search-input" style="min-height:auto; padding-top: 8px;">
                </div>
                
                <button type="submit" class="btn btn-primary" style="justify-content: center;">حفظ الإعدادات</button>
            </form>
        </div>
    </div>

    <!-- Manage Brands Modal (List) -->
    <div id="manageBrandsModal" class="modal-overlay">
        <div class="modal-box scrollable" style="width: 600px; padding: 30px;">
            <div class="modal-close" onclick="closeModal('manageBrandsModal')"><i class="fas fa-times"></i></div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-shrink:0;">
                <h2>إدارة العلامات التجارية</h2>
                <button class="btn btn-primary" style="font-size:14px; padding:10px 20px;" onclick="showBrandForm()">+ إضافة</button>
            </div>
            <div class="admin-brands-list" id="adminBrandsList"></div>
        </div>
    </div>

    <!-- Manage Categories Modal (List) -->
    <div id="manageCategoriesModal" class="modal-overlay">
        <div class="modal-box scrollable" style="width: 600px; padding: 30px;">
            <div class="modal-close" onclick="closeModal('manageCategoriesModal')"><i class="fas fa-times"></i></div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-shrink:0;">
                <h2>إدارة الأقسام</h2>
                <button class="btn btn-primary" style="font-size:14px; padding:10px 20px;" onclick="showCategoryForm()">+ إضافة</button>
            </div>
            <div class="admin-brands-list" id="adminCategoriesList"></div>
        </div>
    </div>

    <!-- Add/Edit Brand Form Modal -->
    <div id="brandFormModal" class="modal-overlay" style="z-index: 2100;">
        <div class="modal-box" style="width: 450px; flex-direction: column; padding: 40px;">
            <div class="modal-close" onclick="closeModal('brandFormModal')"><i class="fas fa-times"></i></div>
            <h2 id="brandFormTitle" style="margin-bottom: 20px;">إضافة براند</h2>
            <form onsubmit="handleBrandSubmit(event)" style="display:flex; flex-direction:column; gap:15px;">
                <input type="hidden" id="brandEditIndex">
                <input type="text" id="brandNameInput" class="search-input" style="min-height:auto;" placeholder="اسم البراند" required>
                
                <div style="border: 1px dashed var(--border-color); padding: 10px; border-radius: 8px;">
                    <label style="display:block; margin-bottom:5px; font-size:14px; font-weight:bold;">شعار البراند</label>
                    <input type="text" id="brandImgInput" class="search-input" style="min-height:auto;" placeholder="رابط الصورة (URL)" style="margin-bottom: 10px;">
                    <input type="file" id="brandImgFile" accept="image/*" class="search-input" style="min-height:auto; padding-top: 8px;">
                </div>

                <button type="submit" class="btn btn-primary" style="justify-content: center;">حفظ</button>
            </form>
        </div>
    </div>

    <!-- Add/Edit Category Form Modal -->
    <div id="categoryFormModal" class="modal-overlay" style="z-index: 2100;">
        <div class="modal-box" style="width: 450px; flex-direction: column; padding: 40px;">
            <div class="modal-close" onclick="closeModal('categoryFormModal')"><i class="fas fa-times"></i></div>
            <h2 id="categoryFormTitle" style="margin-bottom: 20px;">إضافة قسم</h2>
            <form onsubmit="handleCategorySubmit(event)" style="display:flex; flex-direction:column; gap:15px;">
                <input type="hidden" id="categoryEditIndex">
                <input type="text" id="categoryNameInput" class="search-input" style="min-height:auto;" placeholder="اسم القسم" required>
                
                <div style="border: 1px dashed var(--border-color); padding: 10px; border-radius: 8px;">
                    <label style="display:block; margin-bottom:5px; font-size:14px; font-weight:bold;">صورة القسم</label>
                    <input type="text" id="categoryImgInput" class="search-input" style="min-height:auto;" placeholder="رابط الصورة (URL)" style="margin-bottom: 10px;">
                    <input type="file" id="categoryImgFile" accept="image/*" class="search-input" style="min-height:auto; padding-top: 8px;">
                </div>

                <button type="submit" class="btn btn-primary" style="justify-content: center;">حفظ</button>
            </form>
        </div>
    </div>

    <div id="toast" class="toast">تمت الإضافة للسلة</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD6MRZ7d7J1333erYoBrUGqocJNdGNjB7w",
            authDomain: "neew-aec2b.firebaseapp.com",
            databaseURL: "https://neew-aec2b-default-rtdb.firebaseio.com",
            projectId: "neew-aec2b",
            storageBucket: "neew-aec2b.firebasestorage.app",
            messagingSenderId: "70112873200",
            appId: "1:70112873200:web:b8ef2b3863be6f1bf39035"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        console.log("Firebase Initialized");

        const settingsDocRef = doc(db, "app_settings", "general");

        /* =========================================
           DATA & STATE
           ========================================= */
        const initialBrands = [
            { name: "Nutrex Research", logo: "https://upload.wikimedia.org/wikipedia/commons/3/3d/Nutrex_Research_Logo.png" },
            { name: "MuscleTech", logo: "MuscleTech.png" },
            { name: "NOW", logo: "NOW.png" },
            { name: "ALLMAX", logo: "ALLMAX.png" },
            { name: "Force Factor", logo: "Force-Factor.png" },
            { name: "Rule 1", logo: "Rule-1.png" },
            { name: "Optimum Nutrition (ON)", logo: "Optimum-Nutrition.png" },
            { name: "BSN", logo: "BSN.png" },
            { name: "Mutant", logo: "Mutant.png" },
            { name: "Cellucor", logo: "Cellucor.png" },
            { name: "Dymatize", logo: "Dymatize.png" },
            { name: "Perfect Sports", logo: "Perfect-Sports.png" },
            { name: "Primeval Labs", logo: "Primeval-Labs.png" },
            { name: "Animal (Universal Nutrition)", logo: "Animal.png" },
            { name: "JNX Sports", logo: "JNX-Sports.png" },
            { name: "Gaspari Nutrition", logo: "Gaspari.png" }
        ];

        const initialCategories = [
            { name: "Protein", img: "https://images.unsplash.com/photo-1593095948071-474c5cc2989d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
            { name: "Creatine", img: "https://images.unsplash.com/photo-1579722821273-0f6c7d44362f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
            { name: "Pre-Workout", img: "https://images.unsplash.com/photo-1550505293-9c8cb404c107?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" },
            { name: "Vitamins", img: "https://images.unsplash.com/photo-1584308666744-24d5c474f2ae?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" }
        ];

        let brandsData = JSON.parse(localStorage.getItem('amz_brands')) || initialBrands;
        let categoriesData = JSON.parse(localStorage.getItem('amz_categories')) || initialCategories;
        
        const initialProducts = [
            { id: 1, name: "Gold Standard Whey", price: 65, category: "Protein", brand: "Optimum Nutrition (ON)", img: "https://www.gnc.com/dw/image/v2/BBLB_PRD/on/demandware.static/-/Sites-master-catalog-gnc/default/dw1554523c/hi-res/350260_1.jpg", desc: "أفضل بروتين مبيعاً في العالم لسنوات متتالية." },
            { id: 2, name: "Opti-Men", price: 30, category: "Vitamins", brand: "Optimum Nutrition (ON)", img: "https://www.gnc.com/dw/image/v2/BBLB_PRD/on/demandware.static/-/Sites-master-catalog-gnc/default/dwc62955f2/hi-res/916055_1.jpg", desc: "فيتامينات شاملة لصحة الرجل." },
            { id: 3, name: "Platinum Creatine", price: 25, category: "Creatine", brand: "MuscleTech", img: "https://www.gnc.com/dw/image/v2/BBLB_PRD/on/demandware.static/-/Sites-master-catalog-gnc/default/dw9e133c94/hi-res/403756_1.jpg", desc: "كرياتين نقي لضخامة عضلية صافية." }
        ];

        let products = JSON.parse(localStorage.getItem('amz_products')) || initialProducts;
        products = products.map(p => ({...p, brand: p.brand || "Generic"}));

        let cart = JSON.parse(localStorage.getItem('amz_cart')) || [];
        
        let siteConfig = JSON.parse(localStorage.getItem('amz_config')) || {
            theme: 'light',
            heroTitle: "أداء أقوى.<br><span>نتائج أسرع.</span>",
            heroDesc: "احصل على أفضل المكملات الغذائية العالمية بأسعار تنافسية. بروتينات، كرياتين، وفيتامينات أصلية 100%.",
            heroImg: "https://gymers.weebly.com/uploads/5/3/0/4/53045443/3113257_orig.png"
        };

        let currentTheme = siteConfig.theme;
        let isAdmin = false;
        let activeBrand = null; 
        let currentId = null;

        document.documentElement.setAttribute('data-theme', currentTheme);

        onSnapshot(settingsDocRef, (docSnap) => {
            if (docSnap.exists()) {
                const remoteConfig = docSnap.data();
                if (JSON.stringify(remoteConfig) !== JSON.stringify(siteConfig)) {
                    siteConfig = remoteConfig;
                    localStorage.setItem('amz_config', JSON.stringify(siteConfig));
                    applySiteSettings();
                }
            }
        });
        
        // --- Core Functions ---
        window.navigate = function(page, event) {
            const pageElement = document.getElementById(page + '-page');
            if (!pageElement) return;

            document.querySelectorAll('.page-section').forEach(d => d.classList.add('hidden'));
            pageElement.classList.remove('hidden');
            
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            } else if (page !== 'admin') {
                const activeLink = document.querySelector(`.nav-links a[onclick*="'${page}'"]`);
                if (activeLink) activeLink.classList.add('active');
            }
            
            if(page === 'home') activeBrand = null; 
            window.scrollTo(0,0);
            
            if(window.innerWidth <= 768) {
                document.getElementById('navLinks').classList.remove('active');
            }
        };

        window.toggleMenu = function() {
            const nav = document.getElementById('navLinks');
            nav.classList.toggle('active');
        };

        window.openThemeModal = function() { document.getElementById('themeModal').style.display = 'flex'; };
        window.closeModal = function(id) { document.getElementById(id).style.display = 'none'; };
        
        window.setTheme = async function(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            siteConfig.theme = theme;
            localStorage.setItem('amz_config', JSON.stringify(siteConfig));
            try { await setDoc(settingsDocRef, siteConfig); } catch (e) {}
            closeModal('themeModal');
        };

        window.openCheckout = function() {
            if(cart.length === 0) { showToast("السلة فارغة!"); return; }
            const total = cart.reduce((acc, item) => acc + Number(item.price), 0);
            document.getElementById('checkoutTotal').innerText = `$${total.toFixed(2)}`;
            document.getElementById('checkoutModal').style.display = 'flex';
        };

        window.handleCheckout = function(e) {
            e.preventDefault();
            showToast("تم استلام طلبك بنجاح! شكراً لثقتك.");
            cart = [];
            localStorage.setItem('amz_cart', JSON.stringify(cart));
            updateCartCount();
            document.getElementById('checkoutModal').style.display = 'none';
            e.target.reset();
        };

        window.openAdminCheck = function() {
            if(isAdmin) navigate('admin', null);
            else document.getElementById('loginOverlay').style.display = 'flex';
        };

        window.closeLogin = function() { document.getElementById('loginOverlay').style.display = 'none'; };
        
        window.checkLogin = function() {
            if(document.getElementById('adminPass').value === 'alikuka') {
                isAdmin = true;
                document.getElementById('themeSwitcherBtn').style.display = 'flex';
                localStorage.setItem('amz_admin_auth', 'true');
                closeLogin();
                navigate('admin', null);
                renderProducts(); 
            } else {
                alert('كلمة المرور خاطئة');
            }
        };

        window.logoutAdmin = function() { 
            isAdmin = false; 
            document.getElementById('themeSwitcherBtn').style.display = 'none';
            localStorage.removeItem('amz_admin_auth');
            navigate('home', null); 
        };

        window.showAddProductModal = function() {
             document.getElementById('editModal').style.display = 'flex';
             document.querySelector('#editModal form').reset();
             document.getElementById('editId').value = '';
             populateCategoryDropdown(); // populate dynamic categories
        };

        window.showBrandsModal = function() {
            renderBrandsAdmin();
            document.getElementById('manageBrandsModal').style.display = 'flex';
        };

        window.showCategoriesModal = function() {
            renderCategoriesAdmin();
            document.getElementById('manageCategoriesModal').style.display = 'flex';
        };

        window.showSiteSettingsModal = function() {
            document.getElementById('setHeroTitle').value = siteConfig.heroTitle.replace(/<br><span>/g, ' ').replace(/<\/span>/g, '');
            document.getElementById('setHeroDesc').value = siteConfig.heroDesc;
            document.getElementById('setHeroImg').value = siteConfig.heroImg || "";
            document.getElementById('settingsModal').style.display = 'flex';
        };

        window.filterCategory = function(cat, event) {
            document.querySelectorAll('.cat-pill').forEach(b => b.classList.remove('active'));
            if(event && event.target) {
                event.target.classList.add('active');
            } else {
                const btn = document.querySelector(`.cat-pill[data-cat="${cat}"]`);
                if(btn) btn.classList.add('active');
            }
            renderProducts(cat, document.getElementById('searchInput').value);
        };

        window.goToCategory = function(catName) {
            navigate('products', null);
            filterCategory(catName, null);
        };

        window.filterProducts = function() {
            const search = document.getElementById('searchInput').value;
            const activePill = document.querySelector('.cat-pill.active');
            let cat = activePill ? activePill.getAttribute('data-cat') : 'all';
            renderProducts(cat, search);
        };

        window.filterByBrand = function(brandName) {
            activeBrand = brandName;
            navigate('products', null);
            document.getElementById('activeBrandFilter').style.display = 'flex';
            document.getElementById('activeBrandName').innerText = brandName;
            renderProducts();
            window.scrollTo(0,0);
        };

        window.clearBrandFilter = function() {
            activeBrand = null;
            document.getElementById('activeBrandFilter').style.display = 'none';
            renderProducts();
        };

        window.addToCartFromModal = function() {
            if(currentId) window.addToCart(currentId);
            closeModal('productModal');
        };

        window.openProductDetails = function(id) {
            const p = products.find(x => x.id === id);
            currentId = id;
            document.getElementById('modal-img').src = p.img;
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-price').innerText = `$${p.price}`;
            document.getElementById('modal-cat').innerText = p.category;
            document.getElementById('modal-brand').innerText = p.brand || ""; 
            document.getElementById('modal-desc').innerText = p.desc;
            document.getElementById('productModal').style.display = 'flex';
        };

        window.addToCart = function(id) {
            const p = products.find(x => x.id === id);
            cart.push(p);
            localStorage.setItem('amz_cart', JSON.stringify(cart));
            updateCartCount();
            showToast(`تمت إضافة ${p.name}`);
        };

        window.editProduct = function(id) {
            const p = products.find(x => x.id === id);
            populateCategoryDropdown();
            document.getElementById('editId').value = p.id;
            document.getElementById('editName').value = p.name;
            document.getElementById('editPrice').value = p.price;
            document.getElementById('editCat').value = p.category;
            document.getElementById('editBrand').value = p.brand || ""; 
            document.getElementById('editImg').value = p.img;
            document.getElementById('editDesc').value = p.desc;
            document.getElementById('editModal').style.display = 'flex';
        };

        window.deleteProduct = function(id) {
            if(confirm('حذف؟')) {
                products = products.filter(x => x.id !== id);
                localStorage.setItem('amz_products', JSON.stringify(products));
                renderApp();
            }
        };

        window.handleProductSubmit = async function(e) {
            e.preventDefault();
            const id = document.getElementById('editId').value;
            let img = document.getElementById('editImg').value;
            const fileInput = document.getElementById('editImgFile');

            if (fileInput.files && fileInput.files[0]) {
                try { img = await readFileAsBase64(fileInput.files[0]); } catch (err) {}
            }

            const newP = {
                id: id ? Number(id) : Date.now(),
                name: document.getElementById('editName').value,
                price: document.getElementById('editPrice').value,
                category: document.getElementById('editCat').value,
                brand: document.getElementById('editBrand').value || "Generic", 
                img: img || 'https://placehold.co/300', 
                desc: document.getElementById('editDesc').value
            };

            if(id) {
                const idx = products.findIndex(x => x.id == id);
                products[idx] = newP;
            } else {
                products.push(newP);
            }
            
            localStorage.setItem('amz_products', JSON.stringify(products));
            renderApp();
            closeModal('editModal');
            showToast('تم الحفظ');
        };

        window.handleSettingsSubmit = async function(e) {
            e.preventDefault();
            const rawTitle = document.getElementById('setHeroTitle').value;
            const rawDesc = document.getElementById('setHeroDesc').value;
            let img = document.getElementById('setHeroImg').value;
            const fileInput = document.getElementById('setHeroImgFile');

            if (fileInput.files && fileInput.files[0]) {
                try { img = await readFileAsBase64(fileInput.files[0]); } catch (err) {}
            }

            siteConfig.heroTitle = rawTitle; 
            siteConfig.heroDesc = rawDesc;
            if(img) siteConfig.heroImg = img;

            localStorage.setItem('amz_config', JSON.stringify(siteConfig));
            applySiteSettings();
            try { await setDoc(settingsDocRef, siteConfig); } catch (e) {}
            closeModal('settingsModal');
            showToast('تم التحديث');
        };

        /* --- CATEGORIES & BRANDS LOGIC --- */
        window.showBrandForm = function() {
            document.getElementById('brandFormModal').style.display = 'flex';
            document.querySelector('#brandFormModal form').reset();
            document.getElementById('brandEditIndex').value = '';
            document.getElementById('brandFormTitle').innerText = 'إضافة براند جديد';
        };

        window.editBrand = function(index) {
            const b = brandsData[index];
            document.getElementById('brandFormModal').style.display = 'flex';
            document.getElementById('brandEditIndex').value = index;
            document.getElementById('brandNameInput').value = b.name;
            document.getElementById('brandImgInput').value = b.logo;
            document.getElementById('brandFormTitle').innerText = 'تعديل البراند';
        };

        window.handleBrandSubmit = async function(e) {
            e.preventDefault();
            const index = document.getElementById('brandEditIndex').value;
            const name = document.getElementById('brandNameInput').value;
            let img = document.getElementById('brandImgInput').value;
            const fileInput = document.getElementById('brandImgFile');

            if (fileInput.files && fileInput.files[0]) {
                try { img = await readFileAsBase64(fileInput.files[0]); } catch (err) {}
            }

            const newBrand = { name, logo: img || 'https://placehold.co/150x50' };

            if(index !== "") {
                brandsData[index] = newBrand;
            } else {
                brandsData.push(newBrand);
            }

            localStorage.setItem('amz_brands', JSON.stringify(brandsData));
            renderBrands(); 
            renderBrandsAdmin(); 
            closeModal('brandFormModal');
            showToast('تم حفظ البراند');
        };

        window.deleteBrand = function(index) {
            if(confirm('حذف؟')) {
                brandsData.splice(index, 1);
                localStorage.setItem('amz_brands', JSON.stringify(brandsData));
                renderBrands();
                renderBrandsAdmin();
            }
        };

        // Category CRUD
        window.showCategoryForm = function() {
            document.getElementById('categoryFormModal').style.display = 'flex';
            document.querySelector('#categoryFormModal form').reset();
            document.getElementById('categoryEditIndex').value = '';
            document.getElementById('categoryFormTitle').innerText = 'إضافة قسم جديد';
        };

        window.editCategory = function(index) {
            const c = categoriesData[index];
            document.getElementById('categoryFormModal').style.display = 'flex';
            document.getElementById('categoryEditIndex').value = index;
            document.getElementById('categoryNameInput').value = c.name;
            document.getElementById('categoryImgInput').value = c.img;
            document.getElementById('categoryFormTitle').innerText = 'تعديل القسم';
        };

        window.handleCategorySubmit = async function(e) {
            e.preventDefault();
            const index = document.getElementById('categoryEditIndex').value;
            const name = document.getElementById('categoryNameInput').value;
            let img = document.getElementById('categoryImgInput').value;
            const fileInput = document.getElementById('categoryImgFile');

            if (fileInput.files && fileInput.files[0]) {
                try { img = await readFileAsBase64(fileInput.files[0]); } catch (err) {}
            }

            const newCat = { name, img: img || 'https://placehold.co/300' };

            if(index !== "") {
                categoriesData[index] = newCat;
            } else {
                categoriesData.push(newCat);
            }

            localStorage.setItem('amz_categories', JSON.stringify(categoriesData));
            renderCategories(); // Update Public
            renderCategoriesAdmin(); // Update Admin
            renderCategoryFilters(); // Update Filter Pills
            closeModal('categoryFormModal');
            showToast('تم حفظ القسم');
        };

        window.deleteCategory = function(index) {
            if(confirm('حذف هذا القسم؟')) {
                categoriesData.splice(index, 1);
                localStorage.setItem('amz_categories', JSON.stringify(categoriesData));
                renderCategories();
                renderCategoriesAdmin();
                renderCategoryFilters();
            }
        };

        // --- Render Functions ---
        renderApp();

        if (localStorage.getItem('amz_admin_auth') === 'true') {
            isAdmin = true;
            document.getElementById('themeSwitcherBtn').style.display = 'flex';
        }

        function renderApp() {
            renderBrands();
            renderCategories();
            renderCategoryFilters();
            renderProducts();
            initCarousel();
            updateCartCount();
            applySiteSettings();
        }

        function applySiteSettings() {
            document.getElementById('heroTitle').innerHTML = siteConfig.heroTitle;
            document.getElementById('heroDesc').innerHTML = siteConfig.heroDesc;
            const heroImgEl = document.getElementById('heroImgDisplay');
            if(heroImgEl && siteConfig.heroImg) heroImgEl.src = siteConfig.heroImg;
            if(siteConfig.theme) {
                document.documentElement.setAttribute('data-theme', siteConfig.theme);
            }
        }

        function renderBrands() {
            const grid = document.getElementById('brandsGrid');
            if(grid) {
                grid.innerHTML = brandsData.map(b => `
                    <div class="brand-card" onclick="filterByBrand('${b.name}')">
                        <img src="${b.logo}" alt="${b.name}" onerror="this.src='https://placehold.co/150x50?text=${b.name}'">
                    </div>
                `).join('');
            }
        }

        function renderCategories() {
            const grid = document.getElementById('categoriesGrid');
            if(grid) {
                grid.innerHTML = categoriesData.map(c => `
                    <div class="category-card" onclick="goToCategory('${c.name}')">
                        <img src="${c.img}" alt="${c.name}">
                        <div class="category-overlay">
                            <div class="category-info">
                                <h3>${c.name}</h3>
                                <p>تسوق الآن</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderCategoryFilters() {
            const container = document.getElementById('categoryFilters');
            if (!container) return;
            // Keep "All" button
            let html = `<button class="cat-pill active" data-cat="all" onclick="filterCategory('all', event)">الكل</button>`;
            
            categoriesData.forEach(c => {
                html += `<button class="cat-pill" data-cat="${c.name}" onclick="filterCategory('${c.name}', event)">${c.name}</button>`;
            });
            container.innerHTML = html;
        }

        function populateCategoryDropdown() {
            const select = document.getElementById('editCat');
            if(!select) return;
            select.innerHTML = categoriesData.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
        }

        function renderProducts(cat = 'all', search = '') {
            const container = document.getElementById('all-products');
            const adminContainer = document.getElementById('admin-grid');
            
            const filtered = products.filter(p => {
                const matchesCat = (cat === 'all' || p.category === cat);
                const matchesSearch = p.name.toLowerCase().includes(search.toLowerCase());
                const matchesBrand = activeBrand ? p.brand === activeBrand : true;
                return matchesCat && matchesSearch && matchesBrand;
            });

            if(container) {
                if(filtered.length > 0) {
                    container.innerHTML = filtered.map(p => createCard(p)).join('');
                } else {
                    container.innerHTML = `<div style="grid-column: 1/-1; text-align:center; padding:40px; color:var(--text-secondary);">لا توجد منتجات تطابق بحثك.</div>`;
                }
            }
            
            if(adminContainer) adminContainer.innerHTML = filtered.map(p => createCard(p, true)).join('');
        }

        function createCard(p, admin = false) {
            return `
            <div class="product-card">
                <div class="card-img-box">
                    ${!admin ? `<span class="card-tag">${p.category}</span>` : ''}
                    <img src="${p.img}" alt="${p.name}" onerror="this.src='https://placehold.co/300'">
                </div>
                <div class="card-content">
                    <div class="card-brand-name">${p.brand}</div>
                    <h3 class="card-title">${p.name}</h3>
                    <div class="card-price-row">
                        <span class="price">$${p.price}</span>
                        ${admin ? 
                        `<div style="display:flex; gap:5px;">
                            <button class="add-cart-btn" style="background:#ff4757; color:#fff" onclick="deleteProduct(${p.id})"><i class="fas fa-trash"></i></button>
                            <button class="add-cart-btn" onclick="editProduct(${p.id})"><i class="fas fa-pen"></i></button>
                         </div>` : 
                        `<button class="add-cart-btn" onclick="openProductDetails(${p.id})"><i class="fas fa-eye"></i></button>
                         <button class="add-cart-btn" style="background:var(--primary-gradient); color:#fff;" onclick="addToCart(${p.id})"><i class="fas fa-plus"></i></button>`
                        }
                    </div>
                </div>
            </div>
            `;
        }

        function initCarousel() {
            const track = document.getElementById('sliderTrack');
            if(!track) return;
            const items = products.slice(0, 6); 
            const html = items.map(p => `<div style="width: 280px; flex-shrink: 0;">${createCard(p)}</div>`).join('');
            track.innerHTML = html + html + html; 
        }

        function updateCartCount() {
            document.getElementById('cartCount').innerText = cart.length;
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        function renderBrandsAdmin() {
            const list = document.getElementById('adminBrandsList');
            if(!list) return;
            list.innerHTML = brandsData.map((b, index) => `
                <div class="admin-brand-item">
                    <div class="admin-brand-info">
                        <img src="${b.logo}" class="admin-brand-img" onerror="this.src='https://placehold.co/50'">
                        <strong>${b.name}</strong>
                    </div>
                    <div>
                        <button class="btn-sm" style="background:var(--primary-color); color:#fff; padding:5px 10px; border-radius:4px; margin-left:5px;" onclick="editBrand(${index})"><i class="fas fa-pen"></i></button>
                        <button class="btn-sm" style="background:var(--accent-color); color:#fff; padding:5px 10px; border-radius:4px;" onclick="deleteBrand(${index})"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function renderCategoriesAdmin() {
            const list = document.getElementById('adminCategoriesList');
            if(!list) return;
            list.innerHTML = categoriesData.map((c, index) => `
                <div class="admin-brand-item">
                    <div class="admin-brand-info">
                        <img src="${c.img}" class="admin-brand-img" onerror="this.src='https://placehold.co/50'" style="object-fit:cover;">
                        <strong>${c.name}</strong>
                    </div>
                    <div>
                        <button class="btn-sm" style="background:var(--primary-color); color:#fff; padding:5px 10px; border-radius:4px; margin-left:5px;" onclick="editCategory(${index})"><i class="fas fa-pen"></i></button>
                        <button class="btn-sm" style="background:var(--accent-color); color:#fff; padding:5px 10px; border-radius:4px;" onclick="deleteCategory(${index})"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        window.onclick = function(e) {
            if(e.target.classList.contains('modal-overlay')) e.target.style.display = 'none';
        }
    </script>
</body>
</html>
